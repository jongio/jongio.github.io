<!DOCTYPE html>
<html>

<head>
    <script data-ad-client="ca-pub-7253926757222509" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FP3DVRSXN0"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FP3DVRSXN0');
    </script>
    <meta charset="utf-8">
    
    <title>
        
        Python Lessons Learned. Read This Before You Start Building a Distributable Python Package |
        
        Jon Gallant
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="python" />
    
    <meta name="description" content="I just published my first official distributable Python package to PyPI, which makes it available to install via pip install.  It’s called Azure IoT Edge Dev Tool (PyPI, GitHub, Video) and helps IoT E">
<meta property="og:type" content="article">
<meta property="og:title" content="Python Lessons Learned. Read This Before You Start Building a Distributable Python Package">
<meta property="og:url" content="https://blog.jongallant.com/2018/01/python-lessons-learned/index.html">
<meta property="og:site_name" content="Jon Gallant">
<meta property="og:description" content="I just published my first official distributable Python package to PyPI, which makes it available to install via pip install.  It’s called Azure IoT Edge Dev Tool (PyPI, GitHub, Video) and helps IoT E">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.jongallant.com/2018/01/python-lessons-learned/python.png">
<meta property="article:published_time" content="2018-01-04T06:14:25.000Z">
<meta property="article:modified_time" content="2021-03-18T06:53:20.439Z">
<meta property="article:author" content="Jon Gallant">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.jongallant.com/2018/01/python-lessons-learned/python.png">
<meta name="twitter:creator" content="@jongallant">
    

    
    <link rel="alternate" href="http://feeds.feedburner.com/jongallant" title="Jon Gallant"
        type="application/atom+xml" />
    

    
    <link rel="icon" href="/favicon.ico" />
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/titillium-web/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    
<link rel="stylesheet" href="/libs/jquery-ui/1.12.1/jquery-ui.min.css">


    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="//fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    
<link rel="stylesheet" href="/css/style.css">


    
<script src="/libs/jquery/2.0.3/jquery.min.js"></script>

    
<script src="/libs/jquery-ui/1.12.1/jquery-ui.min.js"></script>


    
    
        <script type="text/javascript">
    (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-1148981-8', 'auto');
    ga('send', 'pageview');

</script>
    

<meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism-vsc-dark-plus.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>
    <div id="wrap">
        <header id="header">
  <div id="header-outer" class="outer">
    <div class="container">
      <div class="container-inner">
        <div id="header-title">
          <h1 class="logo-wrap">
            <a href="/" class="logo"></a>
          </h1>
          
        </div>
        <div id="header-inner" class="nav-container">
          <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
          <div class="nav-container-inner">
            <ul id="main-nav">
              
              <li class="main-nav-list-item">
                <a
                  class="main-nav-list-link"
                  href="/"
                  >Home</a
                >
              </li>
               <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Leadership/">Leadership</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Leadership/Career-Model/">Career Model</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Leadership/Proactive-Mentorship/">Proactive Mentorship</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Leadership/Productivity/">Productivity</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Leadership/Review-Model/">Review Model</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Leadership/Work-Life-Balance/">Work:Life Balance</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Puzzles/">Puzzles</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Reviews/">Reviews</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/">Tech</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/3D-Printing/">3D Printing</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Announcements/">Announcements</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Azure/">Azure</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Bugs/">Bugs</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Career/">Career</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Conferences/">Conferences</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Gaming/">Gaming</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/IoT/">IoT</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Jobs/">Jobs</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Microsoft/">Microsoft</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Power-BI/">Power BI</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Reviews/">Reviews</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Story/">Story</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Tips/">Tips</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/category/Tech/Tutorials/">Tutorials</a></li></ul></li></ul> 
              <li class="main-nav-list-item">
                <a
                  class="main-nav-list-link"
                  href="/archives/"
                  >Archive</a
                >
              </li>
              
              <li class="main-nav-list-item">
                <a
                  class="main-nav-list-link"
                  href="/videos/"
                  >Videos</a
                >
              </li>
              
              <li class="main-nav-list-item">
                <a
                  class="main-nav-list-link"
                  href="/contact/"
                  >Contact</a
                >
              </li>
              
            </ul>
            <nav id="sub-nav">
                <script async src="https://cse.google.com/cse.js?cx=partner-pub-7253926757222509:9158994875"></script>
                <div class="gcse-searchbox-only"></div>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/category/Tech/">Tech</a><i class="icon fa fa-angle-right"></i><a class="page-title-link" href="/category/Tech/Tips/">Tips</a>
    </h1>
</div>

                        
                        <div class="main-body-content">
                            <div class="banner-ad">
                                <!-- banner -->
                                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7253926757222509"
                                    data-ad-slot="8838481977" data-ad-format="auto" data-full-width-responsive="true"></ins>
                                <script>
                                    (adsbygoogle = window.adsbygoogle || []).push({});
                                </script>
                            </div>
                            <article id="post-python-lessons-learned" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        Python Lessons Learned. Read This Before You Start Building a Distributable Python Package
        </h1>
    

            </header>
        
        
            <div class="article-subtitle">
                
<a href="/2018/01/python-lessons-learned/" class="article-date">
    <time datetime="2018-01-04T06:14:25.000Z" itemprop="datePublished">2018-01-04</time>
</a>

                
    <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <p>I just published my first official distributable <a href="https://pypi.python.org/pypi/iotedgedev" target="_blank" rel="noopener">Python package to PyPI</a>, which makes it available to install via <code>pip install</code>.  It’s called <strong>Azure IoT Edge Dev Tool</strong> (<a href="https://pypi.python.org/pypi/iotedgedev" target="_blank" rel="noopener">PyPI</a>, <a href="https://github.com/azure/iotedgedev" target="_blank" rel="noopener">GitHub</a>, <a href="https://www.youtube.com/watch?v=lcDFX8PXqUQ" target="_blank" rel="noopener">Video</a>) and helps IoT Edge developers with inner loop dev tasks (dev, test, debug, build, push, release). This post is less about the actual pip package and more about my experience building and distributing one.</p>
<p>Coding in Python is easy. Distributing it as a Python package is hard.  5% of the effort is coding. 95% of the effort goes into figuring out how to distribute the thing.  I spent so many hours struggling through this on my own that I had to share to hopefully save you some ticks.</p>
<p>Let’s jump right in.</p>
<h2 id="Python-Version-2-or-3"><a class="header-anchor" href="#Python-Version-2-or-3"></a>Python Version 2 or 3</h2>
<p>My project works with both Python 2.7 and Python 3.6, but I <strong>should have only coded it for Python 3</strong>.  If you don’t absolutely need to support Python 2.7, then don’t.  I spent way too much time debugging issues that worked on one version but not the other.  I’m building a proof-of-concept package, so I could easily ask my users to install Python 3. In more official organization supported packages, you might not have that luxury.</p>
<h2 id="Isolate-Installs-with-Virtual-Environments"><a class="header-anchor" href="#Isolate-Installs-with-Virtual-Environments"></a>Isolate Installs with Virtual Environments</h2>
<p>I just jumped right in to writing Python code and didn’t realize the concept of Virtual Environments existed in Python.  In a nutshell, it allows you to isolate pip installs from other pip installs, so you avoid versioning conflicts with global packages.  You can read more about them here: <a href="https://docs.python.org/3/tutorial/venv.html" target="_blank" rel="noopener">https://docs.python.org/3/tutorial/venv.html</a></p>
<h2 id="Python-Package-Scaffold-Cookiecutter"><a class="header-anchor" href="#Python-Package-Scaffold-Cookiecutter"></a>Python Package Scaffold: Cookiecutter</h2>
<p>I discovered <a href="https://github.com/audreyr/cookiecutter" target="_blank" rel="noopener">Cookiecutter</a>, the Python package project scaffolding tool, about half way through the creation of my pip package.  I wish I would have known about it earlier, because it is really helpful. It will scaffold out an entire project for you with unit tests, Travis integration, setuptools and so on.  I used the <a href="https://github.com/audreyr/cookiecutter-pypackage" target="_blank" rel="noopener">Cookiecutter PyPackage</a> template, but you can find a lot more of them here: <a href="https://cookiecutter.readthedocs.io/en/latest/readme.html#a-pantry-full-of-cookiecutters" target="_blank" rel="noopener">A Pantry Full of Cookiecutters<br>
</a></p>
<h3 id="Create-Project"><a class="header-anchor" href="#Create-Project"></a>Create Project</h3>
<pre class="line-numbers language-bash"><code class="language-bash">pip install -U cookiecutter
cookiecutter https://github.com/audreyr/cookiecutter-pypackage.git
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="03.png" alt=""></p>
<h3 id="Project-Name"><a class="header-anchor" href="#Project-Name"></a>Project Name</h3>
<p>I wanted to use <code>iotedgedev</code> as my PyPI name <strong>and</strong> GitHub repo and I also wanted <code>iotedgedev</code> to be the command line name. The cookiecutter template didn’t allow that directly so I had to make a few manual edits.  I created a project named <code>iotedgedev</code> and then made these changes:</p>
<ol>
<li>In <code>setup.py</code> changed <code>setup(name=&quot;iotedgedev&quot;)</code></li>
<li>In <code>.travis.yml</code> and <code>travis_pypi_setup.py</code> changed <code>iotedgedev</code> to <code>iotedgedev</code></li>
</ol>
<h3 id="Reserve-Your-Project-Name-on-both-PyPI-Test-and-PyPI-Production-Environments"><a class="header-anchor" href="#Reserve-Your-Project-Name-on-both-PyPI-Test-and-PyPI-Production-Environments"></a>Reserve Your Project Name on both PyPI Test and PyPI Production Environments</h3>
<p>PyPI Test(<a href="https://test.pypi.org" target="_blank" rel="noopener">https://test.pypi.org</a>) and PyPI Production(<a href="https://pypi.org" target="_blank" rel="noopener">https://pypi.org</a>) have different backends, so you need to register your project name with both of them.  Do this immediately after you decide on a name, because someone could register it or you could run into an issue like I did, where I was getting a ]403 because someone already registered the name against the PyPI Test environment](<a href="https://github.com/pypa/warehouse/issues/4607" target="_blank" rel="noopener">https://github.com/pypa/warehouse/issues/4607</a>).  PyPI was able to resolve the issue - but you might not be able to.  Reserve your names.</p>
<h2 id="Testing-Tox-and-unittest"><a class="header-anchor" href="#Testing-Tox-and-unittest"></a>Testing: Tox and unittest</h2>
<p>The template I chose uses <a href="https://pypi.python.org/pypi/tox" target="_blank" rel="noopener">Tox</a> and <a href="https://docs.python.org/2/library/unittest.html" target="_blank" rel="noopener">unittest</a> (not pytest) so I just went with that.  The tests are in the tests folder and were pretty straight forward to write.  Granted, I only did a few simple tests and might switch to pytest at a later time if need be, but for my case unittest worked fine.</p>
<p>Tox is configured in the <code>tox.ini</code> file.  You can set it up to run your code against any Python version and linters such as flake.</p>
<p>When you want to run your tests, you simply navigate to your root and execute <code>tox</code>.</p>
<h2 id="Install-Package-Locally-with-Editable-Installs"><a class="header-anchor" href="#Install-Package-Locally-with-Editable-Installs"></a>Install Package Locally with Editable Installs</h2>
<p>When I first started, I was using full commands such as <code>python edge.py runtime --setup --start</code>, but then I discovered <a href="https://pip.pypa.io/en/stable/reference/pip_install/#editable-installs" target="_blank" rel="noopener">“Editable Installs”</a>, which will install a package from a local or github source without having to have it on PyPI</p>
<p>So, I ran <code>pip install -e .</code> from the root of my project and <code>iotedgedev</code> is now available.</p>
<p>This is super helpful because I can just edit my code and when I go back to the command prompt, iotedgedev commands are all up-to-date without any other installs required.</p>
<h2 id="Package-Distribution-PyPI"><a class="header-anchor" href="#Package-Distribution-PyPI"></a>Package Distribution: PyPI</h2>
<p>After you have coded your project, you are going to want to upload it to <a href="https://testpypi.python.org/pypi" target="_blank" rel="noopener">PyPI test environment</a> to test it out first and then, when ready, upload it to the <a href="https://pypi.python.org/pypi" target="_blank" rel="noopener">PyPI production environment</a>.</p>
<h3 id="Setuptools-not-distutils"><a class="header-anchor" href="#Setuptools-not-distutils"></a>Setuptools, not distutils</h3>
<p>The Cookiecutter project I used included setuptools configuration. After a quick search, I discovered that’s the preferred route, so I just went with it.</p>
<h3 id="Wheel-not-egg"><a class="header-anchor" href="#Wheel-not-egg"></a>Wheel, not egg</h3>
<p>Wheel and Egg are packaging formats, you can read more about them <a href="https://packaging.python.org/discussions/wheel-vs-egg/" target="_blank" rel="noopener">here</a>.  I went with Wheel because it appears to be the recommended approach and it worked the first time I tried it.</p>
<p>To generate a new wheel: <code>python setup.py bdist_wheel</code></p>
<h3 id="Bumpversion"><a class="header-anchor" href="#Bumpversion"></a>Bumpversion</h3>
<p>This package will find all the appropriate versions and bump them up by one when you call it.</p>
<p>To bump the version: <code>bumpversion minor</code></p>
<h3 id="Upload-Process"><a class="header-anchor" href="#Upload-Process"></a>Upload Process</h3>
<ol>
<li>
<p>Push Changes</p>
<pre class="line-numbers language-bash"><code class="language-bash">git add .
git commit -m ""
git push
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>Bumpversion and create Wheel</p>
<pre class="line-numbers language-bash"><code class="language-bash">bumpversion minor &amp;&amp; python setup.py bdist_wheel
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li>
<p>Push Tags</p>
<pre class="line-numbers language-bash"><code class="language-bash">git push --tags
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li>
<p>Upload with Twine</p>
<pre class="line-numbers language-bash"><code class="language-bash">#test
twine upload -r pypitest dist/azure_iot_edge_dev_tool-0.50.0-py2.py3-none-any.whl

#production
twine upload -r pypi dist/azure_iot_edge_dev_tool-0.52.0-py2.py3-none-any.whl
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>This will read from .pypirc file in the root of your project.</p>
</blockquote>
</li>
</ol>
<h3 id="Store-PyPI-Settings-in-pypirc"><a class="header-anchor" href="#Store-PyPI-Settings-in-pypirc"></a>Store PyPI Settings in .pypirc</h3>
<p>Store your PyPI settings in a .pypirc file in the root of your project, which looks something like this:</p>
<pre class="line-numbers language-bash"><code class="language-bash">[distutils]
index-servers =
  pypi
  pypitest

[pypi]
repository=https://pypi.python.org/pypi
username=yourusername
password=

[pypitest]
repository=https://test.pypi.org/legacy/
username=yourusername
password=
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>That way when you call <code>twine upload -r pypi ...</code> it will use the repository, username and password in the file instead of typing it every time you push to PyPI.</p>
<h3 id="Test-Pip-Install"><a class="header-anchor" href="#Test-Pip-Install"></a>Test Pip Install</h3>
<p>When you run pip install it will point to production by default, you need to pass <code>--no-cache-dir</code>, <code>--index-url</code> and an <code>--extra-index-url</code> for it to ignore local packages, point to the test env, and use the production env for project dependencies.</p>
<pre class="line-numbers language-bash"><code class="language-bash">pip --no-cache-dir install --index-url https://test.pypi.org/simple/ iotedgedev --extra-index-url https://pypi.org/simple
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="Command-Line-Arguments-Click"><a class="header-anchor" href="#Command-Line-Arguments-Click"></a>Command Line Arguments: Click</h2>
<p>I started off with <a href="https://docs.python.org/3/library/argparse.html" target="_blank" rel="noopener">argparse</a> and evaluated a few others, but landed on <a href="http://click.pocoo.org" target="_blank" rel="noopener">Click</a> because I like how it is integrated into the code. I had everything working with argparse and it was fine, but one I started writing tests I really appreciated that Click came with a <code>CLiRunner</code> object that was really helpful. I converted everything to Click in an hour or so.  You can see the final result here: <a href="https://github.com/azure/iotedgedev/blob/master/iotedgedev/cli.py" target="_blank" rel="noopener">iotedgedev/iotedgedev/cli.py</a>. You can view the full command structure on GitHub here: <a href="https://github.com/azure/iotedgedev#commands" target="_blank" rel="noopener">iotedgedev/README.md</a></p>
<h3 id="Help-with-h-and-help"><a class="header-anchor" href="#Help-with-h-and-help"></a>Help with -h and --help</h3>
<p>You can get both -h and --help for help commands if you pass this <code>CONTEXT_SETTINGS = dict(help_option_names=[&quot;-h&quot;, &quot;--help&quot;])</code> into the <code>@click.group</code> statement.</p>
<pre class="line-numbers language-py"><code class="language-py">CONTEXT_SETTINGS = dict(help_option_names=['-h', '--help'])


@click.group(context_settings=CONTEXT_SETTINGS, invoke_without_command=True)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Version-Command"><a class="header-anchor" href="#Version-Command"></a>Version Command</h3>
<p>You can easily get a --version command by adding <code>@click.version_option()</code> above your main method:</p>
<pre class="line-numbers language-py"><code class="language-py">@click.version_option()
def main():
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="Help-Print"><a class="header-anchor" href="#Help-Print"></a>Help Print</h3>
<p>You can print out the help message using the following code. In my main Package, I want to print help if not commands are passed in and I want there to be an option hanging off the root.  This is the only way I could figure out how to do that.</p>
<pre class="line-numbers language-py"><code class="language-py">def main(set_config):
    if(set_config):
        utility.set_config()
    else:
        ctx = click.get_current_context()
        if ctx.invoked_subcommand == None:
            click.echo(ctx.get_help())
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Echo-instead-of-Print-Statements"><a class="header-anchor" href="#Echo-instead-of-Print-Statements"></a>Echo instead of Print Statements</h3>
<p>Click comes with an echo method that allows you to colorize your print statements and is Python 2/3 safe.  One of the last things I did in the project was convert all of my statements to use click.secho. Coloring my output helps differentiate it from the output of the out of proc calls I make.</p>
<p>Here, I’m using a mixture of Yellow and White, which looks White and Grey with my current ConEmu color scheme.</p>
<p><img src="05.png" alt=""></p>
<h2 id="Out-of-Process-Calls-subprocess-Popen"><a class="header-anchor" href="#Out-of-Process-Calls-subprocess-Popen"></a>Out of Process Calls: subprocess.Popen</h2>
<p>My script makes a bunch of out of process calls to things like <code>dotnet</code>, <code>docker</code> and <code>iotedgectl</code>.  I toyed around with a bunch of ways to do this and finally landed on subprocess.Popen because I could get both the status code and the result (print statements) from the call.  I wrapped mine in a method like this:</p>
<pre class="line-numbers language-py"><code class="language-py"> def exe_proc(self, params, shell=False):
        proc = subprocess.Popen(
            params, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=shell)

        stdout_data, stderr_data = proc.communicate()
        if stdout_data != "":
            self.output.procout(self.decode(stdout_data))

        if proc.returncode != 0:
            self.output.error(self.decode(stderr_data))
            sys.exit()
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a href="https://github.com/Azure/iotedgedev/blob/master/iotedgedev/utility.py#L24" target="_blank" rel="noopener">https://github.com/Azure/iotedgedev/blob/master/iotedgedev/utility.py#L24</a></p>
<h2 id="PyPI-Readme"><a class="header-anchor" href="#PyPI-Readme"></a>PyPI Readme</h2>
<p>PyPI does not natively support Markdown, although the website says it does, after many hours of trying I could not get it to work.  They do support RST and there are ways to convert Markdown to RST - but nothing was working for me. The Markdown to RST converter I was using <code>pyandoc</code> was not generating valid RST and I was not interested in maintaining two versions (Markdown &amp; RST) of my Readme. If this project was officially supported by Microsoft, then I would have figured it out, but this is a proof-of-concept project, so I decided to abandon the PyPI readme in favor of GitHub markdown and then linked to GitHub from PyPI.</p>
<p>See link to github in this image:</p>
<p><img src="04.png" alt=""></p>
<h2 id="Environment-Variables-Python-DotEnv"><a class="header-anchor" href="#Environment-Variables-Python-DotEnv"></a>Environment Variables: Python-DotEnv</h2>
<p>My package heavily relies on Environment Variables so I can have a very simple command interface.  I did not want to ask the user to type all them in at the command line.  I used dotenv in my node projects and was happy to see that there’s one available for Python as well: <a href="https://github.com/theskumar/python-dotenv" target="_blank" rel="noopener">Python-DotEnv</a>. You can view my .env file here:<a href="https://github.com/Azure/iotedgedev/blob/master/iotedgedev/template/.env.tmp" target="_blank" rel="noopener">iotedgedev/template/.env.tmp</a> and you can see how I’m loading it here: <a href="https://github.com/Azure/iotedgedev/blob/master/iotedgedev/envvars.py#L59" target="_blank" rel="noopener">iotedgedev/envvars.py</a></p>
<p>This will load the .env from the current directory:</p>
<pre class="line-numbers language-py"><code class="language-py">from dotenv import load_dotenv

dotenv_path = os.path.join(os.getcwd(), '.env')
load_dotenv(dotenv_path)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>And make all the Variables available via <code>os.environ[&quot;NAME&quot;]</code></p>
<blockquote>
<p>Make sure you add <code>.env</code> to your .gitignore file.</p>
</blockquote>
<h2 id="Resources"><a class="header-anchor" href="#Resources"></a>Resources</h2>
<p>I found this video really helpful: <a href="https://www.youtube.com/watch?v=4fzAMdLKC5k" target="_blank" rel="noopener">Python Packaging from Init to Deploy</a></p>
<h2 id="Conclusion"><a class="header-anchor" href="#Conclusion"></a>Conclusion</h2>
<p>I still have a lot to learn about Python and package distribution, but I feel like I’m in decent shape after getting this far. I went back and forth from hating Python to sometimes liking it. It took a lot less time to write the Python code then it did to distribute it.</p>
<p>I really hope this posts saves you a time.</p>
<p>Jon</p>

        </div>
        <footer>
        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar">
        <i class="toggle icon"></i>
    </a>
    <div class="sidebar-top">

        <ul class="social-links">
            
            
            <li>
                <a class="social-tooltip" title="twitter" href="http://twitter.com/jongallant"
                    target="_blank">
                    <i class="icon fa fa-twitter"></i>
                </a>
            </li>
            
            
            
            <li>
                <a class="social-tooltip" title="github" href="https://github.com/jongio"
                    target="_blank">
                    <i class="icon fa fa-github"></i>
                </a>
            </li>
            
            
            
            <li>
                <a class="social-tooltip" title="rss" href="http://feeds.feedburner.com/jongallant"
                    target="_blank">
                    <i class="icon fa fa-rss"></i>
                </a>
            </li>
            
            
            
            <li>
                <a class="social-tooltip" title="linkedin" href="http://www.linkedin.com/in/jongallant"
                    target="_blank">
                    <i class="icon fa fa-linkedin"></i>
                </a>
            </li>
            
            
            
            <li>
                <a class="social-tooltip" title="youtube" href="https://www.youtube.com/jongallant"
                    target="_blank">
                    <i class="icon fa fa-youtube"></i>
                </a>
            </li>
            
            
        </ul>
    </div>
    
    
    <nav id="article-nav">
        
            <a href="/2018/01/azure-function-config/" id="article-nav-newer" class="article-nav-link-wrap">
                <strong class="article-nav-caption">
                    newer
                </strong>
                <p class="article-nav-title">
                    
                        Azure Functions v2 Now Uses ASP.NET Core Configuration and No Longer Supports ConfigurationManager
                            
                </p>
                <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>

            </a>
            
                
                    <a href="/2017/12/dotnet-value-cannot-be-null-parameter-name-path1/" id="article-nav-older" class="article-nav-link-wrap">
                        <strong class="article-nav-caption">
                            older
                        </strong>
                        <p class="article-nav-title">
                            Solution to &#39;Value cannot be null. Parameter name: path1&#39; with dotnet and tox
                        </p>
                        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>

                    </a>
                    
    </nav>
    
    

    <div class="widgets-container">
        
        
        <br/>
<div style="position:relative;height:0;padding-bottom:56.25%"><iframe src="https://www.youtube.com/embed/videoseries?list=PLiMIJTv6gK5_Zmdcmbo-kxAbpeGjSou9x&amp;showinfo=0?ecver=2" width="640" height="360" frameborder="0" gesture="media" allow="encrypted-media" style="position:absolute;width:100%;height:100%;left:0" allowfullscreen></iframe></div>
<br/>
        
        <div class="github-card" data-github="jongio" data-width="340" data-height="150" data-theme="default"></div>
<script src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script>
        
        <a class="twitter-timeline" data-height="700" href="https://twitter.com/jongallant?ref_src=twsrc%5Etfw" target="_blank" rel="noopener"></a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        
        
        <div class="rail-ad">
            <!-- rail -->
            <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-7253926757222509"
            data-ad-slot="7222147978"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>

            <!-- 2nd rail -->
            <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-7253926757222509"
            data-ad-slot="1523952970"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>
</aside>
                </div>
            </div>
        </div>
        <div class="banner-ad">
   <!-- footer -->
    <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-7253926757222509"
    data-ad-slot="5729050190"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
<footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo-n"></a>
                </h1>
                <p>&copy;
                    2021
                    Jon Gallant
                </p>
                <p>Disclaimer: The opinions expressed herein are my own personal opinions and do not represent my
                    employer’s view in any way. This post may contain affiliate links. If you use these links to buy something I may earn a commission.</p>
            </div>

        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'jongallant';
    
    
    var disqus_url = 'https://blog.jongallant.com/2018/01/python-lessons-learned/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




<!-- Custom Scripts -->
<!-- 
<script src="/js/main.js"></script>
 -->
<script src="/js/main.js?1"> </script>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-core.min.js" integrity="sha512-xR+IAyN+t9EBIOOJw5m83FTVMDsPd63IhJ3ElP4gmfUFnQlX9+eWGLp3P4t3gIjpo2Z1JzqtW/5cjgn+oru3yQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-zc7WDnCM3aom2EziyDIRAtQg1mVXLdILE09Bo+aE1xk0AM2c2cVLfSW9NrxE5tKTX44WBY0Z2HClZ05ur9vB6A==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/line-numbers/prism-line-numbers.min.js" integrity="sha512-br8H6OngKoLht57WKRU5jz3Vr0vF+Tw4G6yhNN2F3dSDheq4JiaasROPJB1wy7PxPk7kV/+5AIbmoZLxxx7Zow==" crossorigin="anonymous"></script>
</body>

</html>